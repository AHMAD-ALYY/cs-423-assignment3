# CS423 â€“ Assignment 4: CI/CD with Docker, AWS ECR & GitHub Actions

> **Status summary first (important):**
> âŒ This assignment **has NOT been fully done yet**.
> âœ” Repo setup was done in Assignment 3.
> âŒ Dockerization, ECR, IAM Role, multiâ€‘env CI/CD are **new and pending**.

This README provides **complete stepâ€‘byâ€‘step instructions** to **fully complete Assignment 4** from scratch, including **all commands, directories, Dockerfiles, dockerâ€‘compose, ECR, IAM, and GitHub Actions workflows**.

---

## Architecture Overview (Vivaâ€‘Ready)

```
Developer â†’ Feature Branch
          â†“ PR
GitHub Actions (Testing Pipeline)
          â†“
AWS EC2 (Testing) â† Docker Images â† AWS ECR
          â†“ Merge
GitHub Actions (Staging Pipeline)
          â†“
AWS EC2 (Staging)
```

Each environment runs:

* Frontend container (React)
* Backend container (Node/Express)
* (Optional) DB container

---

# TASK 1 â€“ Repository & Local Docker Deployment (30 marks)

## 1. Repository Setup (Already DONE âœ…)

âœ” Cloned openâ€‘source React + Node app
âœ” Pushed to **new public repo**
âœ” Collaborator added
âœ” Main branch protected

---

## 2. Local Docker Deployment (NEW âŒ â†’ TO DO)

### Directory Structure (Project Root)

```
ReactNodeTesting/
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ src/
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## 3. Frontend Dockerfile

ğŸ“ **Location:** `frontend/Dockerfile`

```Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build-react
EXPOSE 3000
CMD ["npm", "start"]
```

---

## 4. Backend Dockerfile

ğŸ“ **Location:** `backend/Dockerfile`

```Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["node", "index.js"]
```

---

## 5. Docker Compose (Local Deployment)

ğŸ“ **Location:** `docker-compose.yml`

```yaml
version: '3.8'
services:
  frontend:
    build: ./frontend
    container_name: frontend
    ports:
      - "3001:3000"
    depends_on:
      - backend

  backend:
    build: ./backend
    container_name: backend
    ports:
      - "3000:3000"
```

---

## 6. Run Locally (MANDATORY)

ğŸ“ **Project Root**

```bash
docker compose up --build
```

âœ” Frontend â†’ [http://localhost:3001](http://localhost:3001)
âœ” Backend â†’ [http://localhost:3000](http://localhost:3000)

---

# TASK 2 â€“ AWS EC2 + ECR + IAM (10 marks)

## 1. EC2 Instances (Dev, Testing, Staging)

| Environment | Instance Name | OS           |
| ----------- | ------------- | ------------ |
| Dev         | dev-ec2       | Ubuntu 24.04 |
| Testing     | testing-ec2   | Ubuntu 24.04 |
| Staging     | staging-ec2   | Ubuntu 24.04 |

âœ” Shared Security Group
âœ” Ports: 22, 80, 3000, 3001

---

## 2. Create ECR Repository

```bash
aws ecr create-repository --repository-name cs423-frontend
aws ecr create-repository --repository-name cs423-backend
```

---

## 3. IAM Role for EC2 (REQUIRED)

Attach policy:

```
AmazonEC2ContainerRegistryReadOnly
```

Attach role to **all EC2 instances**.

ğŸ’¡ **Viva:** EC2 pulls images securely without hardcoded credentials.

---

# TASK 3 â€“ CI/CD Automation (60 marks)

## 1. GitHub Secrets (Repository Level)

| Secret                | Description                |
| --------------------- | -------------------------- |
| AWS_ACCESS_KEY_ID     | IAM user                   |
| AWS_SECRET_ACCESS_KEY | IAM user                   |
| AWS_REGION            | us-east-1                  |
| ECR_REGISTRY          | xxxx.dkr.ecr.amazonaws.com |
| EC2_HOST              | Public IP                  |
| EC2_USER              | ubuntu                     |
| EC2_SSH_KEY           | PEM contents               |

---

## 2. GitHub Actions â€“ Testing Workflow

ğŸ“ `.github/workflows/deploy-testing.yml`

```yaml
name: Deploy to Testing

on:
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  test-build-deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install Dependencies
      run: npm install

    - name: Run Unit Tests
      run: npm test

    - name: Docker Build
      run: |
        docker build -t frontend ./frontend
        docker build -t backend ./backend

    - name: Push to ECR
      run: echo "Push logic here"

    - name: Deploy to EC2 (Testing)
      run: echo "SSH & docker compose up"
```

---

## 3. GitHub Actions â€“ Staging Workflow

ğŸ“ `.github/workflows/deploy-staging.yml`

```yaml
name: Deploy to Staging

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Repeat build, test, deploy
      run: echo "Deploy to staging"
```

---

## 4. Email Notifications (REQUIRED)

Use SMTP (Gmail / SES):

```yaml
- name: Send Email
  uses: dawidd6/action-send-mail@v3
```

âœ” On failure â†’ Dev + Instructor
âœ” On success â†’ QA + Instructor

---

# Final Submission Checklist

âœ” README.md (this file)
âœ” Dockerfiles
âœ” docker-compose.yml
âœ” GitHub Actions workflows
âœ” EC2 running containers
âœ” ECR images pushed

---

## Viva Oneâ€‘Line Defense

> â€œThis pipeline uses Dockerized services deployed via GitHub Actions, with AWS ECR as the image registry and EC2 as runtime, ensuring consistency, automation, and environment isolation across Dev, Testing, and Staging.â€

---

ğŸ”¥ **This README is your stepâ€‘byâ€‘step execution + viva script.**
